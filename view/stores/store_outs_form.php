<?phpinclude_once('../../utils/usr_permission.php');$up = new UsrPermission();$up->requestAccessPage(PermissionType::STORES_MOVEMENTS);include('../../controller/c_stores.php');include('../../utils/validators.php');include_once('../../utils/config.php');include('../../utils/generic_tags.php');$control = new ControllerStores();$val = new Validators();$stock = new ControllerStocks();// Saving data if a tyre was added, modified or deletedif(isset($_POST['hEventStoreOut'])){	$event = $_POST['hEventStoreOut'];		if($event == 'delete')	{		if(!$control->delete_entry_out($_POST['hId']))			echo $error_db;	}	else if($event == 'add' || $event == 'modify')	{		$totalRows = $_POST['hTotalRows'];				if($event != 'add')			$totalRows = 1;				$message = '';				for($i=0; $i < $totalRows; $i++)		{			$index = '(' . ($i + 1) . ')';			// VALIDATE php data						if( $i == 0 || ( $i > 0 && isset($_POST['check'.$i]) ))			{				// Only if this values are not empty, the row data will be saved				$val->isEmpty($_POST['tInputDate'.$i], "FECHA $index", $message);								$val->isEmpty($_POST['hIdTyre'.$i], "LLANTA $index", $message);								if(empty($_POST['sInputStore'.$i]) && empty($_POST['sInputShop'.$i]))					$val->isEmpty($_POST['sInputStore'.$i], "DEPOSITO/TIENDA $index", $message);								$val->isEmpty($_POST['tInputAmount'.$i], "CANTIDAD $index", $message);				if($val->isInt($_POST['tInputAmount'.$i], "CANTIDAD $index", $message))				{					// Checking the stock quantity of the tyre					if( !empty($_POST['hIdTyre'.$i]) && !empty($_POST['tInputAmount'.$i]) )					{						$quantity = $stock->getStoreQuantity($_POST['hIdTyre'.$i], $_SESSION["idStore"]);						if($quantity < $_POST['tInputAmount'.$i])							$val->showMessage("CANTIDAD $index", "Solo se cuenta con $quantity en stock" , $message);					}				}			}		}				if(empty($message))		{			$config = Config::getInstance();			$idCurrentStore = $_SESSION["idStore"];			// Saving data			for($i=0; $i < $totalRows; $i++)			{				if( $i == 0 || ( $i > 0 && isset($_POST['check'.$i]) ))				{					if(!$control->save_out($_POST['hId'],											$idCurrentStore, 											$_POST['hIdTyre'.$i],											$_POST['sInputStore'.$i],											$_POST['sInputShop'.$i],											$config->toBdDateFormat( $_POST['tInputDate'.$i] ),											$_POST['tInputEmployee'.$i],											$_POST['tInputAmount'.$i]))					{						echo $error_db;						break;					}				}			}		}		else			echo $message;	}}else	echo $error;?>